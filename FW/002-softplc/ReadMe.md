# 说明

本工程作为软件PLC模板，可使用以下方式编译:

- [MDK](MDK-ARM):安装好MDK环境后打开目录下的工程文件即可编译。
- [GCC](GCC)：采用[CMake](https://cmake.org)管理源代码，一般用于各种IDE打开编译。注意:由于内存资源较少，其编译的二进制可能不能工作。

# 引脚分配

| 引脚 | 默认功能 | 说明                         |
| ---- | -------- | ---------------------------- |
| PC0  | NRST     | 复位，选项字节开启后有效     |
| PB6  | SWDIO    | 调试及烧录引脚，不可用作它用 |
| PB5  | O0       |                              |
| PB4  | I2C_SDA  |                              |
| PB3  | I2C_SCL  |                              |
| PB2  | I0       |                              |
| PB1  | ADC_CH0  |                              |
| PB0  | ADC_CH7  |                              |
| PA0  | I1       |                              |
| PA1  | I2       |                              |
| PA2  | SWCLK    | 调试及烧录引脚，不可用作它用 |
| PA3  | UART_TX  | 主串口                       |
| PA4  | UART_RX  | 主串口                       |
| PA5  | I3       |                              |
| PA6  | ADC_CH3  |                              |
| PA7  | ADC_CH4  |                              |

# 接口说明

## UART

默认情况下运行[modbus](https://modbus.org) rtu从机。串口参数115200 8N1,modbus rtu从机地址默认为1.

# Modbus资源映射

此章节主要提供从modbus rtu接口访问的数据类型。

注意:此章节的地址为从0开始的地址，某些工业软件上modbus的数据标识是从1开始的,需要注意区别。

## 线圈

| 地址(十进制)范围 | 说明             | 备注                                                   |
| ---------------- | ---------------- | ------------------------------------------------------ |
| [0,15]           | GPIOA的PA0到PA15 | 具体的GPIO模式及引脚复用由固件设定，此处只提供读写操作 |
| [16,31]          | GPIOB的PB0到PB15 | 具体的GPIO模式及引脚复用由固件设定，此处只提供读写操作 |
| [32,47]          | GPIOC的PC0到PC15 | 具体的GPIO模式及引脚复用由固件设定，此处只提供读写操作 |

## 保持寄存器

| 地址(十进制) | 说明         | 备注                                                         |
| ------------ | ------------ | ------------------------------------------------------------ |
| 0            | UID字0低16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |
| 1            | UID字0高16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |
| 2            | UID字1低16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |
| 3            | UID字1高16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |
| 4            | UID字2低16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |
| 5            | UID字2高16位 | 当此寄存器被修改后，任意播功能(非标准modbus功能)将受到影响，原始值仍可通过输入寄存器访问 |

## 输入寄存器

| 地址(十进制)/地址范围(十进制) | 说明                               | 备注                                     |
| ----------------------------- | ---------------------------------- | ---------------------------------------- |
| 0                             | UID字0低16位                       | UID为芯片唯一ID                          |
| 1                             | UID字0高16位                       | UID为芯片唯一ID                          |
| 2                             | UID字1低16位                       | UID为芯片唯一ID                          |
| 3                             | UID字1高16位                       | UID为芯片唯一ID                          |
| 4                             | UID字2低16位                       | UID为芯片唯一ID                          |
| 5                             | UID字2高16位                       | UID为芯片唯一ID                          |
| [6,16]                        | ADC通道IN0到IN10,12位ADC。         | 此处只提供数据读取功能，配置由固件设定。 |
| [17 22]                       | 固件构建时间年、月、日、时、分、秒 | 当所有文件全部重新构建时时间才准确。     |

# 软件PLC

软件PLC见[softplc](softplc)目录

软件PLC的变量支持如下:

| 变量名 | 功能 | 引脚 |
| ------ | ---- | ---- |
| %QX0.0 | O0   | PB5  |
| %IX0.0 | I0   | PB2  |
| %IX0.1 | I1   | PA0  |
| %IX0.2 | I2   | PA1  |
| %IX0.3 | I3   | PA5  |

注意:

- 未在上述支持列表的变量将无法与外界交互。